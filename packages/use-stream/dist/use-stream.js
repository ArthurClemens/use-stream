!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).useStream={},e.React)}(this,(function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=n(t),r=function(){return(r=Object.assign||function(e){for(var t,n=1,u=arguments.length;n<u;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};e.useStream=function(e){var t=e.model,n=e.onMount,o=e.onDestroy,f=e.onUpdate,i=e.deps,a=void 0===i?[]:i,c=e.defer,l=e.debug,s=u.default.useState({}),d=s[0],p=s[1],b=u.default.useRef(!1),y=u.default.useRef([]),m=function(){y.current.length&&(l&&l("Unsubscribe"),y.current.forEach((function(e){return e.end(!0)})),y.current=[])},v=function(){l&&l("createMemo"),m();var e=("function"==typeof t?t:function(){return t})();return function(e){l&&l("Subscribe"),y.current=Object.keys(e).map((function(t){var n=e[t];return!(!n.map||"function"!=typeof n.map)&&n.map((function(e){var n;return l&&l("Will update %s",t),p(r(r({},d),((n={})[t]=e,n))),null}))})).filter(Boolean)}(e),e},g=u.default.useState(c?null:v),h=g[0],j=g[1];return u.default.useEffect((function(){if(b.current&&(l&&l("Updating"),f)){var e=v();j(e),f(e)}}),a),u.default.useEffect((function(){l&&l("Mounting");var e=h;return c&&(e=v(),j(e)),n&&e&&n(e),b.current=!0,function(){l&&l("Unmounting"),m(),o&&o(h)}}),[]),h},Object.defineProperty(e,"__esModule",{value:!0})}));
